# Selectively remove jobs temporarily.
- type: remove
  path: /instance_groups/name=diego-api/jobs/name=silk-controller

# Set the common name for the diego_locket_server certificate.
- type: replace
  path: /variables/name=diego_locket_server/options/common_name
  value: ((deployment-name))-diego-api
- type: replace
  path: /variables/name=diego_locket_server/options/alternative_names
  value:
  - "*.((deployment-name))-diego-api"
  - ((deployment-name))-diego-api
  # 127.0.0.1 is needed by bbs and cfdot to talk to locket without having to hairpin.
  - 127.0.0.1

# Set the common name for the diego_bbs_server certificate.
- type: replace
  path: /variables/name=diego_bbs_server/options/common_name
  value: ((deployment-name))-diego-api
- type: replace
  path: /variables/name=diego_bbs_server/options/alternative_names
  value:
  - "*.((deployment-name))-diego-api"
  - ((deployment-name))-diego-api
  - 
  # 127.0.0.1 is needed by cfdot to talk to bbs without having to hairpin.
  - 127.0.0.1
  # TODO: loop through replica count/az count, not just ordinal 0 (using helm templating)
  - ((deployment-name))-diego-api-0

# Override the addresses for the jobs under the diego-api instance group.
- type: replace
  path: /instance_groups/name=diego-api/jobs/name=locket/properties/diego/locket/sql/db_host
  value: ((deployment-name))-database
- type: replace
  path: /instance_groups/name=diego-api/jobs/name=bbs/properties/diego/bbs/sql/db_host
  value: ((deployment-name))-database
- type: replace
  path: /instance_groups/name=diego-api/jobs/name=bbs/properties/diego/bbs/locket?/api_location
  value: 127.0.0.1:8891
- type: replace
  path: /instance_groups/name=diego-api/jobs/name=bbs/properties/diego/bbs/auctioneer?/api_location
  value: ((deployment-name))-scheduler:9016
- type: replace
  path: /instance_groups/name=diego-api/jobs/name=bbs/properties/diego/bbs/advertisement_base_hostname?
  value: ((deployment-name))-diego-api
- type: replace
  path: /instance_groups/name=diego-api/jobs/name=cfdot/properties/bbs?/hostname
  value: 127.0.0.1
- type: replace
  path: /instance_groups/name=diego-api/jobs/name=cfdot/properties/locket?/hostname
  value: 127.0.0.1

# Disable tuning /proc/sys kernel parameters as locket and bbs are running on containers.
- type: replace
  path: /instance_groups/name=diego-api/jobs/name=locket/properties/set_kernel_parameters?
  value: false
- type: replace
  path: /instance_groups/name=diego-api/jobs/name=bbs/properties/set_kernel_parameters?
  value: false

# Add quarks properties for locket.
- type: replace
  path: /instance_groups/name=diego-api/jobs/name=locket/properties/quarks?
  value:
    ports:
    - name: locket
      protocol: TCP
      internal: 8891

# Add quarks properties for bbs.
- type: replace
  path: /instance_groups/name=diego-api/jobs/name=bbs/properties/quarks?
  value:
    ports:
    - name: cell-bbs-api
      protocol: TCP
      internal: 8889

- type: replace
  path: /instance_groups/name=diego-api/jobs/name=cfdot/properties/quarks?/bpm/processes
  value: []
